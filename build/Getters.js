import{hasTextContent,getBindingVariables,getValuesFromKeys,createBindingObject,attributeIterator,html,getAttributeByName,getObject,getFunctionArguments,getReapeaterArrayPath,isInputNode,handleRepeaterKeys}from"./utils.js";import{ChantersConstants}from"./Chanter_schema.js";import{parseCondition}from"./ConditionExecuter.js";export default class Getters{constructor(...e){const[t,n,r]=e;return this.node=t,this.nodeObject=new Object,this.customElement=n,this.proto=r,this.__FilterNode__(),this.nodeObject}__FilterNode__(){const{node:e}=this;8!==e.nodeType&&(hasTextContent(e)&&e.childNodes.length<1?this.__GetterTextNodes__():1===e.nodeType&&e.attributes.length&&this.__GetterAttributes__())}__GetterTextNodes__(){const{node:e,nodeObject:t}=this;let n=getBindingVariables(e.textContent);n&&(e.processedNode&&(n=handleRepeaterKeys(n,e,t,"textContent")),this.__CreateTextBindingObject__(n))}__GetterInput__(e,t,n,r){const o="checkbox"===e.type,a=o?e.getAttribute("checked"):e.value,i=getBindingVariables(a)[0];if(i){let s=ChantersConstants("EventObject");s.values=[_];const c=getAttributeByName(o?"checked":"value",e);function _(t){r.target=t.target;let n=s.scopeVariable;n.startsWith(e.alias+".")&&(n=getReapeaterArrayPath(e,{nodeValue:n}));getObject(r,n)[n.split(".").pop()]=o?e.checked:e.value}s=this.__CreateEventObject__(c[0],i,s,o?"change":"input"),createBindingObject(n,s)}}__GetterAttributes__(){const{node:e,customElement:t,proto:n,nodeObject:r}=this;e.id&&(t.$[e.id]=e),isInputNode(e)&&this.__GetterInput__(e,n,r,t),attributeIterator(e,n,r,t,((o,a,i,s)=>{if(i)return e.repeater=!0,void this.__CreateRepeater__Object(o);if(s)return e.condition=!0,void this.__CreateConditionObject__(o);e.processedNode&&(a=handleRepeaterKeys(a,e,r,"attribute",o));let c=this.__getAttributeSchema__(o.name);c.values=getValuesFromKeys(a,n,t,e,r),c="Attribute"===c.bindingType?this.__CreateAttributeObject__(o,a,c):this.__CreateEventObject__(o,a,c),createBindingObject(r,c)}))}__CreateConditionObject__(e){const{proto:t,node:n,nodeObject:r,customElement:o}=this,a=ChantersConstants("ConditionObject");a.nextSibling=n.nextSibling,a.parentNode=n.parentNode,a.raw=e.value,a.templateClone=html([n.innerHTML]),a.template=n,a.proto=t,a.customElement=o,parseCondition(a,r,e),createBindingObject(r,a)}__CreateRepeater__Object(e){const{proto:t,node:n,nodeObject:r,customElement:o}=this,a=ChantersConstants("repeaterObject").parsingLevel,i=getReapeaterArrayPath(n,e);a.raw=i,a.targetKey=e.nodeName,a.alias=n.getAttribute("key")||"item",a.targetArray=getObject(t,i),a.proto=t,a.template=n,a.templateClone=html([n.innerHTML]),a.parentCustomElemnt=o,a.nextSibling=n.nextSibling,a.parentNode=n.parentNode,createBindingObject(r,a)}__CreateEventObject__(e,t,n,r){const{node:o,nodeObject:a,customElement:i,proto:s}=this;let c=r||e.name.split("on-")[1];return n.eventName=c,n.functionBody=n.values[0],n.scopeVariable=t,n.raw=e.value,-1!==e.value.indexOf("(")&&(n.arguments=getFunctionArguments(e.value)),n}__CreateAttributeObject__(e,t,n){const{node:r,nodeObject:o,customElement:a,proto:i}=this;return n.raw=e.value,n.keys=t,n.attributeName=e.name,n}__getAttributeSchema__(e){const t=-1!==e.indexOf("on-")?"EventObject":"AttributeObject";return ChantersConstants(t)}__CreateTextBindingObject__(e){const{node:t,proto:n,nodeObject:r,customElement:o}=this,a=ChantersConstants("TextObect");a.keys=e,a.raw=t.textContent.trim(),a.values=getValuesFromKeys(e,n,o,t,r),createBindingObject(r,a)}}